datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  moduleFormat  = "cjs"
}

enum Role {
  USER
  ADMIN
}

enum TourType {
  SOLO
  FAMILY
}

enum TripLabel {
  SALE_ON
  FEATURED
}

enum PaymentMethod {
  CASH_ON_DELIVERY
  ONLINE_PAYMENT
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

// --- Models ---

model User {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email     String   @unique
  password  String   @map("password")
  fullName  String?  @map("full_name")
  avatarUrl String?  @map("avatar_url")
  role      Role     @default(USER)

  // Relations
  reviews   Review[]
  bookings  Booking[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("users")
}

model Trip {
  id               String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name             String
  description      String           @db.Text
  location         String
  duration         String
  tour_type        TourType
  label            TripLabel?
  
  // Pricing
  price            Decimal          @db.Decimal(10, 2)
  discount_price   Decimal?         @db.Decimal(10, 2)
  discount_percent Int?             

  // About Tour Package
  accommodation    String   
  meals            String   
  transportation   String   
  group_size       String   
  language         String   
  age_range        String   
  season           String   
  category         String   

  placeId          String?          @db.Uuid @map("place_id")
  place            Place?           @relation(fields: [placeId], references: [id], onDelete: SetNull)
  brochure_url     String?  
  additional_info  String?          @db.Text 
  images           TripImage[]
  highlights       Highlight[]      
  itineraries      Itinerary[]      
  features         PackageFeature[] 
  faqs             Faq[]            
  reviews          Review[]         
  availabilities   TripAvailability[] 
  additionalServices AdditionalService[] 
  bookings         Booking[]
  capacity         Int      @default(0)

  createdAt        DateTime         @default(now()) @map("created_at") @db.Timestamptz
  updatedAt        DateTime         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@index([category])
  @@index([placeId])
  @@index([tour_type])
  @@map("trips")
}

model TripImage {
  id     String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  url    String
  tripId String @db.Uuid
  trip   Trip   @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@map("trip_images")
}

model Itinerary {
  id          String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  dayNumber   Int
  location    String
  title       String
  description String? @db.Text
  tripId      String  @db.Uuid
  trip        Trip    @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@map("itineraries")
}

model PackageFeature {
  id        String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  text      String
  isInclude Boolean
  tripId    String  @db.Uuid
  trip      Trip    @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@map("package_features")
}

model Highlight {
  id     String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  text   String
  tripId String @db.Uuid
  trip   Trip   @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@map("highlights")
}

model Faq {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  question String
  answer   String @db.Text
  tripId   String @db.Uuid
  trip     Trip   @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@map("faqs")
}

model Review {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  comment     String   @db.Text
  rating      Int    
  overall     Float  
  transport   Float
  food        Float
  hospitality Float
  destination Float
  
  userId      String   @db.Uuid
  user        User     @relation(fields: [userId], references: [id])
  tripId      String   @db.Uuid
  trip        Trip     @relation(fields: [tripId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now()) @db.Timestamptz

  @@map("reviews")
}

model TripAvailability {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  date          DateTime
  maxTravelers  Int      
  bookedCount   Int      @default(0) 
  adultPrice    Decimal  @db.Decimal(10, 2)
  childPrice    Decimal  @db.Decimal(10, 2)

  tripId        String   @db.Uuid
  trip          Trip     @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@map("trip_availabilities")
}

model AdditionalService {
  id     String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name   String
  price  Decimal @db.Decimal(10, 2)
  unit   String
  
  tripId String  @db.Uuid
  trip   Trip    @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@map("additional_services")
}

model Booking {
  id            String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  email         String        
  firstName     String        @map("first_name")
  lastName      String        @map("last_name")
  phone         String?       
  country       String        
  address       String        @db.Text
  city          String        
  state         String        
  zipCode       String        @map("zip_code")

  travelDate    DateTime      @map("travel_date")
  adults        Int           @default(1)
  children      Int           @default(0)
  
  subtotal      Decimal       @db.Decimal(10, 2)
  totalPrice    Decimal       @db.Decimal(10, 2) @map("total_price")

  paymentMethod PaymentMethod @map("payment_method")
  status        BookingStatus @default(PENDING)
  orderNote     String?       @db.Text

  userId        String?       @db.Uuid
  user          User?         @relation(fields: [userId], references: [id])
  tripId        String        @db.Uuid
  trip          Trip          @relation(fields: [tripId], references: [id])

  createdAt     DateTime      @default(now()) @db.Timestamptz

  @@map("bookings")
}

// ==================== CATEGORY/PLACE SYSTEM ====================

// ✅ Category = Region/Country (Africa, Asia, Bangladesh)
model Category {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String   @unique // "Africa", "Asia", "Bangladesh"
  slug      String   @unique // ✅ ADDED: "africa", "asia", "bangladesh"
  image     String?  // ✅ ADDED: Category main image
  order     Int      @default(0) // ✅ ADDED: Display order
  isActive  Boolean  @default(true) // ✅ ADDED: Active/Inactive
  
  // Relations
  places    Place[]  // Places under this category
  
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("categories")
}

// ✅ Place = Specific location (Dhaka, South Africa, Kenya)
model Place {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String   // "Dhaka", "South Africa", "Kenya"
  slug         String   @unique // ✅ ADDED: "dhaka", "south-africa"
  image        String   // Main card image
  bannerImage  String?  // ✅ ADDED: Hero banner for detail page
  shortDesc    String?  // ✅ ADDED: Short description for card
  
  // ✅ ADDED: Place details (for country pages)
  capital      String?  // "Pretoria", "Nairobi"
  currency     String?  // "BDT", "ZAR", "KES"
  language     String?  // "Bengali", "English, Afrikaans"
  timezone     String?  // "GMT+6", "GMT+2"
  visaRequired Boolean? @default(false)
  restrictions String?  @db.Text
  
  // Category relation
  categoryId   String   @db.Uuid @map("category_id")
  category     Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  
  // Display options
  order        Int      @default(0) // ✅ ADDED: Display order
  isFeatured   Boolean  @default(false) // ✅ ADDED: Show on homepage
  
  // Relations
  details      PlaceDetails? // Popular places, experiences, weather
  trips        Trip[]        // ✅ ADDED: Tours for this place
  
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@index([categoryId])
  @@index([slug]) // ✅ ADDED: Index for slug queries
  @@map("places")
}

// ✅ PlaceDetails = Extended info for a place
model PlaceDetails {
  id                   String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  placeId              String               @unique @db.Uuid @map("place_id")
  place                Place                @relation(fields: [placeId], references: [id], onDelete: Cascade)

  // Popular spots in this place
  popular_places       Json?                // [{name: "Sajek", image: "url", city: "Rangamati"}]
  
  // Relations
  customer_experiences CustomerExperience[] // Customer reviews/activities
  seasonal_info        SeasonalInfo[]       // Best time to visit

  @@map("place_details")
}

// ✅ CustomerExperience = Recent customer activities
model CustomerExperience {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  customerName   String?      // ✅ ADDED: Customer name (optional)
  image          String       // Customer photo
  description    String       @db.Text // What they experienced
  rating         Float?       // ✅ ADDED: Rating (optional)
  visitDate      DateTime?    // ✅ ADDED: When they visited
  
  placeDetailsId String       @db.Uuid @map("place_details_id")
  placeDetails   PlaceDetails @relation(fields: [placeDetailsId], references: [id], onDelete: Cascade)
  
  createdAt      DateTime     @default(now()) @map("created_at") @db.Timestamptz // ✅ ADDED

  @@map("customer_experiences")
}

// ✅ SeasonalInfo = Best time to visit
model SeasonalInfo {
  id                 String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  season             String       // "Spring (March-May)"
  weather_celsius    String       // "12-20°C"
  weather_fahrenheit String       // "53-68°F"
  highlights         String[]     // ["Cherry blossoms", "Moderate crowds"]
  perfect_for        String[]     // ["First-time travelers", "couples"]
  image              String?      
  order              Int          @default(0) // ✅ ADDED: Display order
  
  placeDetailsId     String       @db.Uuid @map("place_details_id")
  placeDetails       PlaceDetails @relation(fields: [placeDetailsId], references: [id], onDelete: Cascade)
  
  createdAt          DateTime     @default(now()) @map("created_at") @db.Timestamptz // ✅ ADDED
  updatedAt          DateTime     @default(now()) @updatedAt @map("updated_at") @db.Timestamptz // ✅ ADDED

  @@map("seasonal_info")
}


model ServiceSection {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  heading    String
  subHeading String?
  isActive   Boolean  @default(true)

  features   ServiceFeature[]

  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt  DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([isActive])
}

model ServiceFeature {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title       String
  description String
  icon        String
  order       Int      @default(0)
  isActive    Boolean  @default(true)

  sectionId   String   @db.Uuid @map("section_id")
  section     ServiceSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([sectionId, isActive])
  @@unique([sectionId, order])
}


model ContactSection {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  offices   ContactOffice[]
  messages  ContactMessage[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@map("contact_sections")
}

model ContactOffice {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title        String
  contact      String
  addressLine1 String
  addressLine2 String

  sectionId    String   @db.Uuid @map("section_id")
  section      ContactSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt    DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@map("contact_offices")
}

model ContactMessage {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String
  email         String
  phoneNumber   String
  message       String   @db.Text
  destination   String?
  agreeToPolicy Boolean  @default(false)

  sectionId     String?  @db.Uuid @map("section_id")
  section       ContactSection? @relation(fields: [sectionId], references: [id], onDelete: SetNull)

  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@map("contact_messages")
}

